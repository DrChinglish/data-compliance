{% load static %}

<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>数据合规{% block title %}{% endblock title %}</title>
  <link rel="icon" type="image/x-icon" href="{% static "/img/favicon.ico" %}" />

  <!-- Google Font: Source Sans Pro -->
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
  <!-- Font Awesome -->
  <link href="/static/plugins/fontawesome-free/css/all.min.css" rel="stylesheet">
  <!-- Theme style -->
  <link href="/static/dist/css/adminlte.min.css" rel="stylesheet">

  <!-- daterange picker -->
  <link rel="stylesheet" href="/static/plugins/daterangepicker/daterangepicker.css">
  <!-- iCheck for checkboxes and radio inputs -->
  <link rel="stylesheet" href="/static/plugins/icheck-bootstrap/icheck-bootstrap.min.css">
  <!-- Bootstrap Color Picker -->
  <link rel="stylesheet" href="/static/plugins/bootstrap-colorpicker/css/bootstrap-colorpicker.min.css">
  <!-- Tempusdominus Bootstrap 4 -->
  <link rel="stylesheet" href="/static/plugins/tempusdominus-bootstrap-4/css/tempusdominus-bootstrap-4.min.css">
  <!-- Select2 -->
  <link rel="stylesheet" href="/static/plugins/select2/css/select2.min.css">
  <link rel="stylesheet" href="/static/plugins/select2-bootstrap4-theme/select2-bootstrap4.min.css">
  <!-- Bootstrap4 Duallistbox -->
  <link rel="stylesheet" href="/static/plugins/bootstrap4-duallistbox/bootstrap-duallistbox.min.css">
  <!-- BS Stepper -->
  <link rel="stylesheet" href="/static/plugins/bs-stepper/css/bs-stepper.min.css">
  <!-- Chart -->
  <!-- <link href="\static\plugins\chart.js\Chart.min.css" rel="stylesheet"> -->
  <!-- 上传文件样式 -->
  <link rel="stylesheet" href="/static/plugins/dropzone/min/dropzone.min.css">



  <!-- NProgress -->
  <!-- <link href="/static/nprogress/css/nprogress.css" rel="stylesheet"> -->
  <!-- iCheck -->
  <!-- <link href="/static/nprogress/css/green.css" rel="stylesheet"> -->
  <!-- Custom Theme Style -->
  <!-- <link href="/static/nprogress/css/custom.min.css" rel="stylesheet"> -->
  <!-- Bootstrap -->
  <!-- <link href="/static/nprogress/css/bootstrap.min.css" rel="stylesheet"> -->



  <!--  自定义样式-->
  <link rel="stylesheet" href="/static/css/baseadminstyle.css">


</head>


<body class="hold-transition sidebar-mini {% block bodyclass %} {% endblock %}">
  <!-- Site wrapper -->
  <div class="wrapper">

    <!-- Navbar -->
    <nav class="main-header navbar navbar-expand navbar-white navbar-light">
      <!-- Left navbar links -->
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a>
        </li>

      </ul>







      <!-- <ul class=" navbar-right">
        <li class="nav-item dropdown open" style="padding-left: 15px;">
          <a href="javascript:;" class="user-profile dropdown-toggle" aria-haspopup="true" id="navbarDropdown"
            data-toggle="dropdown" aria-expanded="false">
            <img src="/static/dist/img/user2-160x1600.jpg" alt="">John Doe
          </a>
          <div class="dropdown-menu dropdown-usermenu pull-right" aria-labelledby="navbarDropdown"
            x-placement="bottom-start"
            style="position: absolute; will-change: transform; top: 0px; left: 0px; transform: translate3d(15px, 21px, 0px);">
            <a class="dropdown-item" href="javascript:;"> Profile</a>
            <a class="dropdown-item" href="javascript:;">
              <span class="badge bg-red pull-right">50%</span>
              <span>Settings</span>
            </a>
            <a class="dropdown-item" href="javascript:;">Help</a>
            <a class="dropdown-item" href="login.html"><i class="fa fa-sign-out pull-right"></i> Log Out</a>
          </div>
        </li>
      </ul> -->







      <ul class="navbar-nav ml-auto">
        <li class="nav-item">
          <a class="nav-link" data-widget="navbar-search" href="#" role="button">
            <i class="fas fa-search"></i>
          </a>
          <div class="navbar-search-block" style="display: none;">
            <form class="form-inline">
              <div class="input-group input-group-sm">
                <input class="form-control form-control-navbar" type="search" placeholder="Search" aria-label="Search">
                <div class="input-group-append">
                  <button class="btn btn-navbar" type="submit">
                    <i class="fas fa-search"></i>
                  </button>
                  <button class="btn btn-navbar" type="button" data-widget="navbar-search">
                    <i class="fas fa-times"></i>
                  </button>
                </div>
              </div>
            </form>
          </div>
        </li>
        <li class="nav-item">
          <a class="nav-link" data-widget="fullscreen" href="#" role="button">
            <i class="fas fa-expand-arrows-alt"></i>
          </a>
        </li>

        <li class="nav-item dropdown" >
          <a class="nav-link "  href="javascript:;" data-toggle="dropdown">
            <i class="fas fa-th-large"></i>
          </a>
          <div class="dropdown-menu pull-right"  
            style="position: absolute; will-change: transform; top: 0px; right: 0px; transform: translate3d(15px, 21px, 0px);">
            <a class="dropdown-item" href="javascript:;"> 账户</a>
            <a class="dropdown-item" href="javascript:;">
              <span>设置</span>
            </a>
            <a class="dropdown-item" href="javascript:;">帮助</a>
            <a class="dropdown-item" href="/logout/"><i class="fa fa-sign-out pull-right"></i> 退出</a>
          </div>
        </li>

      </ul>


    </nav>
    <!-- /.navbar -->

    <!-- Main Sidebar Container -->
    <aside class="main-sidebar sidebar-dark-primary elevation-4">
      <!-- Brand Logo -->
      <a href="/" class="brand-link">
        <img src="/static/dist/img/AdminLTELogo.png" alt="AdminLTE Logo" class="brand-image img-circle elevation-3"
          style="opacity: .8">
        <span class="brand-text font-weight-light">Data Compliance</span>
      </a>

      <!-- Sidebar -->
      <div class="sidebar">
        <!-- Sidebar user (optional) -->
        <div class="user-panel mt-3 pb-3 mb-3 d-flex">
          <div class="image">
            <img src="/static/dist/img/user2-160x160.jpg" class="img-circle elevation-2" alt="User Image">
          </div>
          <div class="info">
            <a href="#" class="d-block">{{ request.session.user_name }}</a>
          </div>
        </div>

        <!-- SidebarSearch Form -->
        <div class="form-inline">
          <div class="input-group" data-widget="sidebar-search">
            <input class="form-control form-control-sidebar" type="search" placeholder="Search" aria-label="Search">
            <div class="input-group-append">
              <button class="btn btn-sidebar">
                <i class="fas fa-search fa-fw"></i>
              </button>
            </div>
          </div>
        </div>

        <!-- Sidebar Menu -->
        <nav class="mt-2">
          <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu" data-accordion="false">
            <li class="nav-item">
              <a href="/post_list/" class="nav-link {% block li1class %} {% endblock %}">
                <i class="nav-icon fas fa-columns"></i>
                <p>
                  表格数据
                </p>
              </a>
            </li>

            <li class="nav-item">
              <a href="/post_list/" class="nav-link">
                <i class="nav-icon fas fa-columns"></i>
                <p>
                  文本数据
                </p>
              </a>
            </li>
            <li class="nav-item">
              <a href="/post_list/" class="nav-link">
                <i class="nav-icon fas fa-columns"></i>
                <p>
                  语音数据
                </p>
              </a>
            </li>
            <li class="nav-item">
              <a href="/post_list/" class="nav-link">
                <i class="nav-icon fas fa-columns"></i>
                <p>
                  图片数据
                </p>
              </a>
            </li>

            <li class="nav-item">
              <a href="#" class="nav-link">
                <i class="nav-icon fas fa-columns"></i>
                <p>
                  项目列表
                  <i class="right fas fa-angle-left"></i>
                </p>
              </a>
              <ul class="nav nav-treeview">
                <li class="nav-item">
                  <a href="/post_list/" class="nav-link">
                    <i class="far fa-circle nav-icon"></i>
                    <p>表格数据</p>
                  </a>
                </li>
                <li class="nav-item">
                  <a href="../../index2.html" class="nav-link">
                    <i class="far fa-circle nav-icon"></i>
                    <p>文本数据</p>
                  </a>
                </li>
                <li class="nav-item">
                  <a href="../../index3.html" class="nav-link">
                    <i class="far fa-circle nav-icon"></i>
                    <p>语音数据</p>
                  </a>
                </li>
                <li class="nav-item">
                  <a href="../../index3.html" class="nav-link">
                    <i class="far fa-circle nav-icon"></i>
                    <p>图片数据</p>
                  </a>
                </li>
              </ul>
            </li>



          </ul>
        </nav>
        <!-- /.sidebar-menu -->
      </div>
      <!-- /.sidebar -->
    </aside>


    <div class="content-wrapper">

      {% block content %}

      {% endblock content %}

    </div>






    <aside class="control-sidebar control-sidebar-dark">
      <!-- Control sidebar content goes here -->
    </aside>

  </div>


  <!-- jQuery -->
  <script src="/static/plugins/jquery/jquery.min.js"></script>
  <!-- Bootstrap 4 -->
  <script src="/static/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
  <!--  App -->
  <script src="/static/dist/js/adminlte.min.js"></script>

  <!-- 上传文件js -->
  <script src="/static/plugins/dropzone/min/dropzone.min.js"></script>

  <!--jspdf-->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.2/jspdf.debug.js"></script>


  <!-- html2canvasjs -->
  <script src="https://cdn.bootcss.com/html2canvas/0.5.0-beta4/html2canvas.js"></script>

  <!-- bootstrap swich -->
  <script src="/static/plugins/bootstrap-switch/js/bootstrap-switch.min.js"></script>

  <!-- bootstrap colorpicker -->
  <script src="/static/plugins/bootstrap-colorpicker/js/bootstrap-colorpicker.min.js"></script>

  <!-- select2 -->
  <script src="/static/plugins/select2/js/select2.full.min.js"></script>

  <!-- Bootstrap4 Duallistbox -->
  <script src="/static/plugins/bootstrap4-duallistbox/jquery.bootstrap-duallistbox.min.js"></script>


  <!-- FLOT CHARTS -->
  <!-- <script src="/static/plugins/flot/jquery.flot.js"></script> -->
  <!-- FLOT PIE PLUGIN - also used to draw donut charts -->
  <!-- <script src="/static/plugins/flot/plugins/jquery.flot.pie.js"></script> -->
  <!-- FLOT RESIZE PLUGIN - allows the chart to redraw when the window is resized -->
  <!-- <script src="/static/plugins/flot/plugins/jquery.flot.resize.js"></script> -->

  <!-- Chart.js -->
  <script src="\static\plugins\jquery\Chart.min.js"></script>


  <!-- 自定义样式 -->
  <script src="/static/js/baseadminstyle.js"></script>



  <script>

    if ($('#canvasRadar').length) {

      var ctx = document.getElementById("canvasRadar");
      var data = {
        labels: ["合规性", "隐私性", "完整性", "可用性", "规范性"],
        datasets: [{
          label: "My Second dataset",
          backgroundColor: "rgba(38, 185, 154, 0.2)",
          borderColor: "rgba(38, 185, 154, 0.85)",
          pointColor: "rgba(38, 185, 154, 0.85)",
          pointStrokeColor: "#fff",
          pointHighlightFill: "#fff",
          pointHighlightStroke: "rgba(151,187,205,1)",

          data: [65, 88, 90, 55, 90]
        },]
      };

      var canvasRadar = new Chart(ctx, {
        type: 'radar',
        data: data,
        options: {
          showDatasetLabels: true,
          elements: {
            line: {
              borderWidth: 2
            }
          },
          scale: {
            ticks: {
              suggestedMin: 0,
              suggestedMax: 100,
              beginAtZero: true,
              display: false,

            },

          },
        }
      });

    }



    // 文件上传
    $(function () {
      Dropzone.autoDiscover = false;
      new Dropzone("#upload", {
        clickable: ".dropzone",
        url: "upload/",
        maxFiles: 2,
        maxFilesize: 50,
        acceptedFiles: '.excel, .png, .csv',
        previewsContainer: "#previewsContainer",
        uploadMultiple: true,
        autoProcessQueue: false,
        dictDefaultMessage: '拖动文件至此或者点击上传',
        dictMaxFilesExceeded: "您最多只能上传1个文件！",
        dictResponseError: '文件上传失败!',
        dictInvalidFileType: "文件类型只能是*.excel,*.png,*.csv。",
        dictFallbackMessage: "浏览器不受支持",
        dictFileTooBig: "文件过大上传文件最大支持.",
        dictRemoveLinks: "删除",
        dictCancelUpload: "取消",
        init() {
          var myDropzone = this;
          this.element.querySelector("[type=submit]").addEventListener("click", function (e) {
            e.preventDefault();
            e.stopPropagation();
            myDropzone.processQueue();
          });
          // this.on("queuecomplete", function() {
          // //Redirect URL
          //  'post_list/';
          // });

          this.on('success', function (files, response) {
            if (response['message']) {
              alert(response['message'])
              window.location.href = '/new_post/';
              // window.location.href = '@Url.Action("Action", "Controller", new { param1 = "aa", param2 = "aaa" })';
            } else {
              window.location.href = '/post_list/';
            }
          });


        }
      });







      // 文件上传区域点击或者拖拽后，不显示里面的文字
      let btn = document.getElementById("previewsContainer");
      btn.addEventListener('drop', function () {
        var t = document.getElementById('my-btn')
        t.style.display = 'none';
      });
      btn.addEventListener('click', function () {
        var t = document.getElementById('my-btn')
        t.style.display = 'none';
      });
    });



    // 高风险数据
    $(function () {
      // 高风险数据高亮显示
      // let mybtn = document.getElementById("high-level");
      // mybtn.addEventListener('click', function(){
      var data = JSON.parse("{{data|escapejs}}");
      var tab = document.getElementById("mytable");
      var rows = tab.rows;
      // alert('qqqqqqq')
      for (var x in data) {
        for (var y in data[x]) {
          rows[parseInt(x)].cells[parseInt(data[x][y])].classList.add('high-level-light');
        }
      }
      // });
      // 处理高风险数据
      let mybtn = document.getElementById("handel-high-level");
      mybtn.addEventListener('click', function () {
        var time = new Date();
        var handle_time = time.toLocaleString();                      //获取要传到后台d的点击事件发生的时间
        $.ajax({
          type: "GET",
          url: "{{post.get_absolute_url}}?high_level_handle_time=" + handle_time,   //后台处理函数的url
          // data:handle_time,
          success: function replaceDoc()                                //成功后执行此函数
          {
            // window.location.replace("{{post.get_absolute_url}}?high_level_handle_time="+handle_time)
            window.location.replace("{{post.get_absolute_url}}")
          },
        });
      });
    });



    // 中风险数据高亮显示
    $(function () {
      // let midmybtn = document.getElementById("middle-level");
      // window.addEventListener('load', function(){
      var data = JSON.parse("{{middle_data|escapejs}}");
      var tab = document.getElementById("mytable");
      var rows = tab.rows;
      for (var x in data) {
        for (var y in data[x]) {
          rows[parseInt(x)].cells[parseInt(data[x][y])].classList.add('middle-level-light');
        }
      }
      // });

      let mybtn = document.getElementById("handel-middle-level");
      mybtn.addEventListener('click', function () {
        var time = new Date();
        var handle_time = time.toLocaleString();                      //获取要传到后台d的点击事件发生的时间
        $.ajax({
          type: "GET",
          url: "{{post.get_absolute_url}}?middle_level_handle_time=" + handle_time,   //后台处理函数的url
          // data:handle_time,
          success: function replaceDoc()                                //成功后执行此函数
          {
            // window.location.replace("{{post.get_absolute_url}}?high_level_handle_time="+handle_time)
            window.location.replace("{{post.get_absolute_url}}")
          },
        });
      });
    });


    // 低风险数据高亮显示
    $(function () {
      // let mybtnaa = document.getElementById("high-level");
      // mybtnaa.addEventListener('load', function(){
      var data = JSON.parse("{{low_data|escapejs}}");
      var tab = document.getElementById("mytable");
      var rows = tab.rows;
      for (var x in data) {
        for (var y in data[x]) {
          rows[parseInt(x)].cells[parseInt(data[x][y])].classList.add('low-level-light');
        }
      }
      // });

      let mybtn = document.getElementById("handel-low-level");
      mybtn.addEventListener('click', function () {
        var time = new Date();
        var handle_time = time.toLocaleString();                      //获取要传到后台d的点击事件发生的时间
        $.ajax({
          type: "GET",
          url: "{{post.get_absolute_url}}?low_level_handle_time=" + handle_time,   //后台处理函数的url
          // data:handle_time,
          success: function replaceDoc()                                //成功后执行此函数
          {
            // window.location.replace("{{post.get_absolute_url}}?high_level_handle_time="+handle_time)
            window.location.replace("{{post.get_absolute_url}}")
          },
        });
      });
    });


    // 下载pdf报告
    function Convert_HTML_To_PDF() {
      var elementHTML = document.getElementById('contentToPrint');
      elementHTML.style.background = "#FFFFFF";

      html2canvas(elementHTML, {
        onrendered: function (canvas) {
          var contentWidth = canvas.width;
          var contentHeight = canvas.height;

          //一页pdf显示html页面生成的canvas高度;
          var pageHeight = contentWidth / 592.28 * 841.89;
          //未生成pdf的html页面高度
          var leftHeight = contentHeight;
          //页面偏移
          var position = 0;
          //a4纸的尺寸[595.28,841.89]，html页面生成的canvas在pdf中图片的宽高
          var imgWidth = 595.28;
          var imgHeight = 592.28 / contentWidth * contentHeight;

          var pageData = canvas.toDataURL('image/jpeg', 1.0);

          var pdf = new jsPDF('', 'pt', 'a4');

          //有两个高度需要区分，一个是html页面的实际高度，和生成pdf的页面高度(841.89)
          //当内容未超过pdf一页显示的范围，无需分页
          if (leftHeight < pageHeight) {
            pdf.addImage(pageData, 'JPEG', 0, 0, imgWidth, imgHeight);
          } else {
            while (leftHeight > 0) {
              pdf.addImage(pageData, 'JPEG', 0, position, imgWidth, imgHeight)
              leftHeight -= pageHeight;
              position -= 841.89;
              //避免添加空白页
              if (leftHeight > 0) {
                pdf.addPage();
              }
            }
          }

          pdf.save("{{ post.title }}.pdf");
        }
      })
    }



  </script>



</body>

</html>